<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„ØªØ¹Ø±Ù‘Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ â€” Ù†Ø³Ø®Ø© Netlify</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--mint:#3ad6b5;--ink:#0a1024;--bg1:#f7f9fc;--bg2:#eaf3ff;}
    *{box-sizing:border-box}
    body{font-family:'Tajawal',sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--ink);margin:0;min-height:100vh;display:flex;flex-direction:column;align-items:center;}
    h1{margin-top:50px;font-size:1.6rem;color:var(--ink);text-align:center}
    .camera-container{display:flex;flex-direction:column;align-items:center;gap:.8rem;margin-top:1rem;background:#fff;border-radius:16px;box-shadow:0 0 10px rgba(0,0,0,.1);padding:1rem;width:min(90%,760px)}
    video,img{width:100%;border-radius:10px;border:1px solid var(--mint);background:#e0f7f5}
    .btn-row{display:flex;flex-wrap:wrap;justify-content:center;gap:.5rem}
    button{background:var(--mint);border:none;color:#fff;font-size:1rem;padding:.5rem 1rem;border-radius:8px;cursor:pointer}
    button:disabled{background:#b0e8dc;cursor:not-allowed}
    #aiStatus{color:#333;font-size:.95rem;margin-top:.5rem;text-align:center;white-space:pre-line}
    .ai-float{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:120;background:rgba(0,0,0,.45);backdrop-filter:blur(6px)}
    .ai-float .card{background:rgba(255,255,255,.95);border:2px solid var(--mint);border-radius:16px;padding:1rem;width:min(90%,420px);text-align:center;color:var(--ink)}
    footer{margin-top:auto;padding:1rem;font-size:.9rem;color:#333}
  </style>
</head>
<body>
  <h1>Ø§Ù„ØªØ¹Ø±Ù‘Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h1>
  <div class="camera-container">
    <div class="btn-row">
      <button id="aiStart"><i class="fa-solid fa-video"></i> ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
      <button id="aiCapture" disabled><i class="fa-solid fa-camera"></i> Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø©</button>
      <button id="aiStop" disabled><i class="fa-solid fa-square"></i> Ø¥ÙŠÙ‚Ø§Ù</button>
    </div>
    <video id="aiVideo" autoplay playsinline muted></video>
    <img id="aiPreview" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¬Ù‡Ø§Ø²" style="display:none">
    <p id="aiStatus">Ù„Ù… ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø¹Ø¯.</p>
    <canvas id="aiCanvas" style="display:none"></canvas>
  </div>
  <div class="ai-float" id="aiFloat">
    <div class="card">
      <h3>ğŸ§  ØªÙ… Ø§Ù„ØªØ¹Ø±Ù‘Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²</h3>
      <img id="aiFloatImg" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¬Ù‡Ø§Ø²" style="width:100%;border-radius:12px;border:1px solid var(--mint);object-fit:cover;">
      <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="aiFloatTitle">â€”</span></p>
      <p><strong>Ø§Ù„ÙØ¦Ø©:</strong> <span id="aiFloatCat">â€”</span></p>
      <p><strong>Ø§Ù„Ù‚Ø¯Ø±Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:</strong> <span id="aiFloatWatt">â€”</span> ÙˆØ§Ø·</p>
      <p><strong>Ø§Ù„Ø«Ù‚Ø©:</strong> <span id="aiFloatConf">â€”</span></p>
      <button id="aiApply"><i class="fa-solid fa-bolt"></i> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙŠÙ…</button>
    </div>
  </div>
  <footer>âš™ï¸ ÙŠØ¹Ù…Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆÙŠØ³ØªØ®Ø¯Ù… MobileNet (TensorFlow.js)</footer>
  <script>
    let mobilenetModel=null;const aiStart=document.getElementById('aiStart');const aiCapture=document.getElementById('aiCapture');const aiStop=document.getElementById('aiStop');const aiVideo=document.getElementById('aiVideo');const aiCanvas=document.getElementById('aiCanvas');const aiPreview=document.getElementById('aiPreview');const aiStatus=document.getElementById('aiStatus');const aiFloat=document.getElementById('aiFloat');const aiFloatImg=document.getElementById('aiFloatImg');const aiFloatTitle=document.getElementById('aiFloatTitle');const aiFloatCat=document.getElementById('aiFloatCat');const aiFloatWatt=document.getElementById('aiFloatWatt');const aiFloatConf=document.getElementById('aiFloatConf');const aiApply=document.getElementById('aiApply');let aiStream=null;
    const labelToCategoryMap={'tv':'ØªÙ„ÙØ§Ø²','monitor':'ØªÙ„ÙØ§Ø²','screen':'ØªÙ„ÙØ§Ø²','laptop':'Ø­Ø§Ø³ÙˆØ¨ Ù…Ø­Ù…ÙˆÙ„','computer':'Ø­Ø§Ø³ÙˆØ¨ Ù…ÙƒØªØ¨ÙŠ','phone':'Ù‡Ø§ØªÙ','air':'Ù…ÙƒÙŠÙ‘Ù Ù‡ÙˆØ§Ø¡','conditioner':'Ù…ÙƒÙŠÙ‘Ù Ù‡ÙˆØ§Ø¡','refrigerator':'Ø«Ù„Ø§Ø¬Ø©','fridge':'Ø«Ù„Ø§Ø¬Ø©','microwave':'Ù…ÙŠÙƒØ±ÙˆÙˆÙŠÙ','oven':'ÙØ±Ù† ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ','heater':'Ø³Ø®Ø§Ù† ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ','iron':'Ù…ÙƒÙˆØ§Ø©','kettle':'ØºÙ„Ø§ÙŠØ© Ù…Ø§Ø¡','printer':'Ø·Ø§Ø¨Ø¹Ø©','fan':'Ù…Ø±ÙˆØ­Ø©','router':'Ù…ÙˆØ²Ù‘Ø¹ Ø¥Ù†ØªØ±Ù†Øª'};
    const defaultWatts={'Ù…ÙƒÙŠÙ‘Ù Ù‡ÙˆØ§Ø¡':1500,'Ø«Ù„Ø§Ø¬Ø©':120,'ÙØ±Ù† ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ':1800,'Ù…ÙŠÙƒØ±ÙˆÙˆÙŠÙ':1200,'ØªÙ„ÙØ§Ø²':100,'Ø­Ø§Ø³ÙˆØ¨ Ù…Ø­Ù…ÙˆÙ„':60,'Ø­Ø§Ø³ÙˆØ¨ Ù…ÙƒØªØ¨ÙŠ':200,'Ù‡Ø§ØªÙ':5,'Ù…Ø±ÙˆØ­Ø©':45,'ØºÙ„Ø§ÙŠØ© Ù…Ø§Ø¡':2000,'Ù…ÙƒÙˆØ§Ø©':1400,'Ø·Ø§Ø¨Ø¹Ø©':60,'Ø³Ø®Ø§Ù† ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ':1500,'Ù…ÙˆØ²Ù‘Ø¹ Ø¥Ù†ØªØ±Ù†Øª':12};
    function statusMsg(m){aiStatus.textContent=m;}
    async function loadModel(){if(typeof mobilenet==='undefined'){await import('https://cdn.jsdelivr.net/npm/@tensorflow/tfjs');await import('https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet');}mobilenetModel=await mobilenet.load();statusMsg('âœ… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø§Ù‡Ø²');}
    async function startCamera(){try{await loadModel();aiStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});aiVideo.srcObject=aiStream;aiCapture.disabled=false;aiStop.disabled=false;statusMsg('ğŸ¥ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØ¹Ù…Ù„');}catch(e){statusMsg('ØªØ¹Ø°Ù‘Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: '+e.message);}}
    function stopCamera(){if(aiStream){aiStream.getTracks().forEach(t=>t.stop());aiStream=null;aiVideo.srcObject=null;}aiCapture.disabled=true;aiStop.disabled=true;statusMsg('â¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§');}
    async function capture(){if(!mobilenetModel){await loadModel();}const w=aiVideo.videoWidth,h=aiVideo.videoHeight;if(!w||!h){statusMsg('Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ù‹Ø§ Ø«Ù… Ø­Ø§ÙˆÙ„.');return;}aiCanvas.width=w;aiCanvas.height=h;const ctx=aiCanvas.getContext('2d');ctx.drawImage(aiVideo,0,0,w,h);const dataUrl=aiCanvas.toDataURL('image/png');aiPreview.src=dataUrl;aiPreview.style.display='block';statusMsg('ğŸ“Š Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...');const img=new Image();img.src=dataUrl;await new Promise(r=>img.onload=r);const preds=await mobilenetModel.classify(img);let label='ØºÙŠØ± ÙˆØ§Ø¶Ø­',cat='ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',watts=null,conf=null;if(preds&&preds[0]){label=(preds[0].className||'').toLowerCase();conf=preds[0].probability;for(const k in labelToCategoryMap){if(label.includes(k)){cat=labelToCategoryMap[k];break;}}watts=defaultWatts[cat]||null;}aiFloatImg.src=dataUrl;aiFloatTitle.textContent=label;aiFloatCat.textContent=cat;aiFloatWatt.textContent=watts?watts:'â€”';aiFloatConf.textContent=conf?Math.round(conf*100)+'%':'â€”';aiFloat.style.display='flex';aiApply.onclick=()=>{localStorage.setItem('ai_last_detection',JSON.stringify({label,category:cat,watts,confidence:conf}));aiFloat.style.display='none';statusMsg('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');};}
    aiStart.onclick=startCamera;aiStop.onclick=stopCamera;aiCapture.onclick=capture;
  </script>
</body>
</html>
